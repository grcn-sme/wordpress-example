<!DOCTYPE html>
<html lang="en">

<head>
<link rel="alternate icon" class="js-site-favicon" type="image/png" href="https://github.githubassets.com/favicons/favicon-dark.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test</title>
    <style>
        html {
            background-color: black;
        }
    </style>
    
    
</head>

<body>
    <script>
        (async function loadBodyCode() {

            const res = await fetch('https://raw.githubusercontent.com/grcn-sme/wordpress-example/refs/heads/main/custom-code/body.html?date=' + new Date().getTime(), { method: 'get', cache: 'no-store' });
            const htmlCode = await res.text();
            const doc = new DOMParser().parseFromString(htmlCode, 'text/html');

            // clone html tag into main body, and re-execute tag script
            Array.prototype.forEach.call(doc.querySelectorAll('head>*,body>*'), TAG => {
                const tag = document.createElement(TAG.tagName);
                for (const a of TAG.attributes) {
                    tag.setAttribute(a.name, a.value);
                }
                tag.innerHTML = TAG.innerText;
                document.body.appendChild(tag);
            });
        })().then(x => console.log(x));
    </script>
    <script>
        function injectCustomCode(htmlCode, intoElement) {
            const doc = new DOMParser().parseFromString(htmlCode, "text/html");
            const getTextNode = node => {

            };
            let addText;
            if (intoElement === document.head) {
                const nodeToAdd = [];
                addText = (TAG) => {
                    nodeToAdd.push(new Text(TAG.textContent));
                    setTimeout(_ => {
                        document.body.prepend(nodeToAdd.pop());
                    });
                }
            } else {
                addText = (TAG) => {
                    intoElement.appendChild(new Text(TAG.textContent));
                };
            }
            const cloneChildNodes = (TAG) => {
                try {
                    if (TAG.attributes === undefined) {
                        if (TAG.nodeName === '#text') {
                            addText(TAG);
                            return new Text(TAG.textContent);
                        }
                        else if (TAG.nodeName === '#comment') {
                            intoElement.appendChild(new Comment(TAG.textContent));
                        }
                        else {
                            console.warn('unknown node type, assume as textNode instead: ', TAG);
                            addText(TAG);
                        }
                    } else {
                        const tag = document.createElement(TAG.tagName);
                        for (const a of TAG.attributes) {
                            tag.setAttribute(a.name, a.value);
                        }
                        tag.innerHTML = TAG.textContent;
                        intoElement.appendChild(tag);
                    }
                } catch (err) {
                    console.warn(err);
                }
            };
            doc.head.childNodes.forEach(cloneChildNodes);
            doc.body.childNodes.forEach(cloneChildNodes);
        }
    </script>

</body>

</html>